<!-- admin_panel/templates/admin_panel/manage_jobs.html -->
{% extends 'base.html' %}
{% block content %}

<div class="bg-gray-800 text-white p-4 flex justify-between items-center shadow-md mb-6">
<div class="font-bold text-lg">
  <a href="{% url 'admin_panel:dashboard' %}" class="text-white no-underline">
    ⚙️ CampusForce Admin Panel
  </a>
</div>
  <div class="space-x-2">
    <a href="{% url 'admin_panel:manage_users' %}" class="bg-indigo-600 hover:bg-indigo-700 px-3 py-1 rounded text-sm">Users</a>
    <a href="{% url 'admin_panel:manage_projects' %}" class="bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-sm">Projects</a>
    <a href="{% url 'admin_panel:manage_livework' %}" class="bg-yellow-500 hover:bg-yellow-600 px-3 py-1 rounded text-sm">LiveWork</a>
    <a href="{% url 'admin_panel:manage_jobs' %}" class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm">Job Apps</a>
    <a href="/logout/" class="bg-gray-700 hover:bg-gray-900 px-3 py-1 rounded text-sm">Logout</a>
  </div>
</div>
<div class="p-6">
  <h2 class="text-xl font-semibold mb-4">Job Applications</h2>

  <div class="bg-white rounded shadow p-4">
    <table class="w-full text-left">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-2">ID</th>
          <th class="p-2">Candidate</th>
          <th class="p-2">Job</th>
          <th class="p-2">Status</th>
          <th class="p-2">Resume</th>
          <th class="p-2">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for a in apps %}
        <tr class="border-b">
          <td class="p-2">{{ a.id }}</td>
          <td class="p-2">{{ a.user.email }}</td>
          <td class="p-2">{{ a.job.title }}</td>
          <td class="p-2">{{ a.status }}</td>

          <!-- Resume: View / Download -->
          <td class="p-2">
            {% if a.resume %}
              <a href="{{ a.resume.url }}" target="_blank" class="text-green-600 mr-2">View</a>
              <a href="{% url 'admin_panel:download_resume' a.id %}" class="text-indigo-600">Download</a>
            {% else %}
              —
            {% endif %}
          </td>

          <!-- Actions: Status + conditional info -->
          <td class="p-2">
            <form method="post" action="{% url 'admin_panel:update_job_status' a.id %}" style="display:inline;">
              {% csrf_token %}
              <select name="status" onchange="this.form.submit()">
                {% for key, label in a.STATUS_CHOICES %}
                  <option value="{{ key }}" {% if a.status == key %}selected{% endif %}>{{ key }}</option>
                {% endfor %}
              </select>
            </form>

            <!-- Conditional fields -->
            {% if a.status == 'shortlisted' %}
              <div class="mt-2">
                <strong>Assessment Link:</strong>
                <input type="text" value="{{ a.assessment_link|default:'' }}" readonly class="border p-1 rounded w-full">
              </div>
            {% elif a.status == 'rejected' %}
              <div class="mt-2">
                <strong>Rejection Reason:</strong>
                <textarea readonly class="border p-1 rounded w-full">{{ a.rejection_reason|default:'—' }}</textarea>
              </div>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="p-3 text-gray-500">No applications.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
